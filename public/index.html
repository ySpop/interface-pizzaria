<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Hugo Domingos Pina" />
    <link
      rel="icon"
      href="/assets/images/pizzaria_pina_banner-fotor-20240823822.png"
      type="image/png"
    />
    <link rel="stylesheet" href="/styles/style.css" />
    <link rel="stylesheet" href="/styles/comanda.css" />
    <link rel="stylesheet" href="/styles/addproductdb.css" />
    <link rel="stylesheet" href="/styles/fechamento.css" />
    <link rel="stylesheet" href="/styles/addaccount.css" />
    <link rel="stylesheet" href="/styles/tablePagamentos.css" />
    <link rel="stylesheet" href="/styles/tableVendas.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/awesomplete/1.1.5/awesomplete.min.css"
    />
    <title>Pizzaria Pina</title>

    <script type="module" defer src="/scripts/menu.js"></script>
    <script type="module" defer src="/scripts/formData.js"></script>
    <script type="module" defer src="/scripts/salesDetails.js"></script>
    <script
      defer
      src="https://cdnjs.cloudflare.com/ajax/libs/awesomplete/1.1.5/awesomplete.min.js"
    ></script>
  </head>
  <body class="body">
    <header class="header outmodal-content">
      <section class="header-content container-grid">
        <h3 class="header-content-title">Pizzaria Pina</h3>
        <h5 id="username-display"></h5>

        <div class="right-header-content">
          <button class="btn-login">Login</button>
          <button type="submit" class="btn-logout">Logout</button>
          <button class="btn-menu">Menu</button>
        </div>
      </section>
    </header>

    <main>
      <section class="main-content outmodal-content">
        <section class="menu-opcoes-holder">
          <section class="menu-opcoes-content">
            <div class="menu-content-top">
              <img
                class="btn-close-menu"
                src="/assets/icons/close_24dp_5F6368_FILL0_wght400_GRAD0_opsz24.svg"
                alt="Fechar menu"
              />
            </div>
            <div class="buttons-container">
              <button class="btn-comanda menu-buttons">
                Adicionar comanda
              </button>

              <button class="btn-fechamento menu-buttons">
                Fechamento de Caixa
              </button>

              <button class="btn-newproductdb menu-buttons">
                Adicionar produto ao DB
              </button>

              <button class="btn-removeproductdb menu-buttons">
                Remover produto do DB
              </button>

              <button class="btn-editproductdb menu-buttons">
                Alterar produto do DB
              </button>

              <button class="btn-payments menu-buttons">
                Tabela de pagamentos
              </button>

              <button class="btn-sales menu-buttons">Tabela de vendas</button>

              <button class="btn-addaccount menu-buttons">
                Adicionar conta
              </button>
            </div>
          </section>
        </section>

        <section class="comanda-content">
          <form class="comanda-form" id="venda-form">
            <div class="comanda-top-container">
              <div class="comanda-top-time">
                <div class="comanda-top-left">
                  <img
                    src="/assets/icons/schedule_24dp_5F6368_FILL0_wght400_GRAD0_opsz24.svg"
                    alt="Horário"
                  />
                  <h5 class="comanda-time-text">Digite a hora</h5>
                </div>
                <input class="input-order-time" type="time" name="order-time" />
              </div>

              <div class="comanda-top-date">
                <div class="comanda-top-left">
                  <img
                    src="/assets/icons/event_24dp_5F6368_FILL0_wght400_GRAD0_opsz24.svg"
                  />
                  <h5 class="comanda-order-date">Digite a data</h5>
                </div>
                <input
                  class="input-order-date"
                  type="text"
                  name="order-date"
                  maxlength="10"
                />
              </div>
            </div>

            <div class="comanda-items-container">
              <div class="comanda-items-top">
                <img
                  src="/assets/icons/note_alt_24dp_5F6368_FILL0_wght400_GRAD0_opsz24.svg"
                  alt="Notas"
                />
                <h5 class="comanda-items-text">Digite os itens</h5>
              </div>

              <div class="inputs-container"></div>
            </div>

            <div class="comanda-items-btn">
              <button class="btn-add-meia">Adicionar meia a meia</button>
              <button class="btn-add-item">Adicionar item</button>
            </div>

            <div class="comanda-address-container">
              <div class="comanda-address-top">
                <img
                  src="/assets/icons/location_on_24dp_5F6368_FILL0_wght400_GRAD0_opsz24.svg"
                  alt="Localização"
                />
                <h5 class="comanda-address-text">Digite o endereço</h5>

                <input class="input-address" type="text" name="order-address" />
                <input
                  class="input-address-number"
                  type="number"
                  name="order-address-number"
                />
              </div>
              <div class="comanda-address-bottom">
                <img
                  src="/assets/icons/other_houses_24dp_5F6368_FILL0_wght400_GRAD0_opsz24.svg"
                />
                <h5 class="comanda-address-text">Digite o bairro</h5>
                <input
                  class="input-neighbourhood"
                  type="text"
                  name="order-neighbourhood"
                />
              </div>
            </div>

            <div class="comanda-bottom-container">
              <div class="comanda-method-container">
                <img
                  src="/assets/icons/credit_card_24dp_5F6368_FILL0_wght400_GRAD0_opsz24.svg"
                  alt="Método de pagamento"
                />
                <h5 class="comanda-method-text">
                  Digite o método de pagamento
                </h5>

                <input
                  class="input-method-payment"
                  type="text"
                  name="method-payment"
                  maxlength="20"
                />
              </div>
              <div class="comanda-cost-container">
                <img
                  src="/assets/icons/attach_money_24dp_5F6368_FILL0_wght400_GRAD0_opsz24.svg"
                  alt="Custo"
                />
                <h5 class="comanda-cost-text">Digite o preço</h5>

                <input
                  class="input-cost-payment"
                  type="number"
                  name="cost-payment"
                  maxlength="20"
                  step="0.01"
                  min="0"
                />
              </div>
            </div>

            <div class="buttons-form">
              <button
                class="order-type-btn"
                type="button"
                id="toggle-order-type"
              >
                Entrega
              </button>
              <input
                type="hidden"
                id="order-type"
                name="order-type"
                value="Entrega"
              />
              <button id="btn-delete-last-item">Retroceder item</button>
              <button id="btn-reset-form" class="erase-button btn-reset-form">
                Apagar
              </button>
              <button id="btn-send-form" class="send-button send-venda-form">
                Enviar
              </button>
            </div>
          </form>
        </section>

        <section class="add-product-content">
          <form class="add-product-form" id="add-product-form">
            <div class="add-product-top">
              <h4>
                Preencha as informações para adicionar um item ao banco de
                dados.
              </h4>
            </div>

            <hr class="form-line" />

            <div class="add-product-name add-product-inputs">
              <img
                src="/assets/icons/edit_24dp_5F6368_FILL0_wght400_GRAD0_opsz24.svg"
              />
              <input
                type="text"
                name="product-name"
                placeholder="Digite o nome do produto"
              />
            </div>

            <div class="add-product-description add-product-inputs">
              <img
                src="/assets/icons/description_24dp_5F6368_FILL0_wght400_GRAD0_opsz24.svg"
              />
              <input
                type="text"
                name="product-description"
                placeholder="Digite a descrição do produto"
              />
            </div>

            <div class="add-product-price add-product-inputs">
              <img
                src="/assets/icons/attach_money_24dp_5F6368_FILL0_wght400_GRAD0_opsz24.svg"
                alt="Custo"
              />
              <input
                type="number"
                name="product-price"
                placeholder="Digite o preço do produto"
                step="0.01"
                min="0"
              />
            </div>

            <div class="add-product-size add-product-inputs">
              <img
                src="/assets/icons/straighten_24dp_5F6368_FILL0_wght400_GRAD0_opsz24.svg"
              />
              <input
                type="text"
                name="product-size"
                placeholder="Digite o tamanho do produto"
              />
            </div>

            <div class="add-product-type add-product-inputs">
              <img
                src="/assets/icons/format_list_bulleted_24dp_5F6368_FILL0_wght400_GRAD0_opsz24.svg"
                alt="Custo"
              />
              <select id="product-type-selector" name="product-type" required>
                <option value="Pizza">Pizza</option>
                <option value="Calzone">Calzone</option>
                <option value="Porção">Porção</option>
                <option value="Beirute">Beirute</option>
                <option value="Esfiha_Doce">Esfiha Doce</option>
                <option value="Bebida">Bebida</option>
                <option value="Lanche">Lanche</option>
                <option value="Sorvete">Sorvete</option>
                <option value="Milkshake">Milkshake</option>
              </select>
            </div>

            <div class="buttons-form">
              <button class="erase-button btn-reset-form">Apagar</button>
              <button id="send-addproduct-form" class="send-button">
                Enviar
              </button>
            </div>
          </form>
        </section>

        <section class="fechamento-container-all">
          <section class="fechamento-content">
            <form class="fechamento-form" id="fechamento-form">
              <section class="fechamento-groups-holder">
                <div class="fechamento-top-text">
                  <h5>Preencha TODOS os dados</h5>
                </div>
                <div class="fechamento-top-container">
                  <div class="entry-date">
                    <label class="label-data">Data do fechamento</label>
                    <input
                      class="input-fechamento-date"
                      type="text"
                      name="input-fechamento-date"
                      maxlength="10"
                    />
                  </div>

                  <div class="entry-initial-container">
                    <label class="label-initial">Valor inicial</label>
                    <input
                      class="input-initial-valor"
                      type="number"
                      name="initial-valor"
                      step="0.01"
                      min="0"
                    />
                  </div>

                  <div class="entry-final-valor">
                    <label class="label-final">Valor final</label>
                    <input
                      class="input-final-valor"
                      type="number"
                      name="final-valor"
                      step="0.01"
                      min="0"
                    />
                  </div>

                  <div class="entry-container">
                    <div class="entry-top">
                      <img
                        src="/assets/icons/add_24dp_5F6368_FILL0_wght400_GRAD0_opsz24.svg"
                      />
                      <h5>Entrada</h5>
                    </div>

                    <div class="entry-inputs-container">
                      <div class="entry-input-group">
                        <label class="label-pix">PIX</label>
                        <input
                          class="input-pix"
                          type="number"
                          name="input-pix"
                          step="0.01"
                          min="0"
                        />
                      </div>

                      <div class="entry-input-group">
                        <label class="label-credito">Crédito</label>
                        <input
                          class="input-credito"
                          type="number"
                          name="input-credito"
                          step="0.01"
                          min="0"
                        />
                      </div>

                      <div class="entry-input-group">
                        <label class="label-debito">Débito</label>
                        <input
                          class="input-debito"
                          type="number"
                          name="input-debito"
                          step="0.01"
                          min="0"
                        />
                      </div>

                      <div class="entry-input-group">
                        <label class="label-dinheiro">Dinheiro</label>
                        <input
                          class="input-dinheiro"
                          type="number"
                          name="input-dinheiro"
                          step="0.01"
                          min="0"
                        />
                      </div>
                    </div>
                  </div>

                  <div class="out-container">
                    <div class="out-top">
                      <img
                        src="/assets/icons/remove_24dp_5F6368_FILL0_wght400_GRAD0_opsz24.svg"
                      />
                      <h5>Saída</h5>
                    </div>

                    <div class="out-inputs-container">
                      <div class="out-input-group">
                        <label class="">Valor saída</label>
                        <input
                          class="input-pix"
                          type="number"
                          name="input-pix"
                          step="0.01"
                          min="0"
                        />
                      </div>
                    </div>
                  </div>
                </div>
              </section>

              <div class="fechamento-bottom-container">
                <button class="fechamento-clear-btn fechamento-bottom-btns">
                  Apagar
                </button>
                <button class="fechamento-send-btn fechamento-bottom-btns">
                  Enviar
                </button>
              </div>
            </form>
          </section>

          <section class="pagamento-fun-content">
            <form id="pagamento-funcionarios-form">
              <section class="funcionarios-group-holder">
                <div class="funcionario-group">
                  <hr class="funcionarios-line" />
                  <img
                    class="trash-pagamento-icon"
                    src="/assets/icons/delete_24dp_5F6368_FILL0_wght400_GRAD0_opsz24.svg"
                  />

                  <select
                    class="funcionario-selector"
                    name="funcionario-id"
                    required
                  ></select>
                  <input
                    class="input-funcionario-data"
                    type="text"
                    placeholder="Data"
                    maxlength="10"
                  />
                  <input
                    class="input-funcionario-pagamento"
                    type="number"
                    placeholder="Pagamento"
                    step="0.01"
                    min="0"
                  />
                  <input
                    class="input-funcioario-descricao"
                    type="text"
                    placeholder="Descrição"
                  />
                  <select
                    class="funcionario-account-selector"
                    name="funcionario-account"
                    required
                  ></select>
                </div>

                <div class="funcionario-group">
                  <hr class="funcionarios-line" />
                  <img
                    class="trash-pagamento-icon"
                    src="/assets/icons/delete_24dp_5F6368_FILL0_wght400_GRAD0_opsz24.svg"
                  />

                  <select
                    class="funcionario-selector"
                    name="funcionario-id"
                    required
                  ></select>
                  <input
                    class="input-funcionario-data"
                    type="text"
                    placeholder="Data"
                    maxlength="10"
                  />
                  <input
                    class="input-funcionario-pagamento"
                    type="number"
                    placeholder="Pagamento"
                    step="0.01"
                    min="0"
                  />
                  <input
                    class="input-funcioario-descricao"
                    type="text"
                    placeholder="Descrição"
                  />
                  <select
                    class="funcionario-account-selector"
                    name="funcionario-account"
                    required
                  ></select>
                </div>

                <div class="funcionario-group">
                  <hr class="funcionarios-line" />
                  <img
                    class="trash-pagamento-icon"
                    src="/assets/icons/delete_24dp_5F6368_FILL0_wght400_GRAD0_opsz24.svg"
                  />

                  <select
                    class="funcionario-selector"
                    name="funcionario-id"
                    required
                  ></select>
                  <input
                    class="input-funcionario-data"
                    type="text"
                    placeholder="Data"
                    maxlength="10"
                  />
                  <input
                    class="input-funcionario-pagamento"
                    type="number"
                    placeholder="Pagamento"
                    step="0.01"
                    min="0"
                  />
                  <input
                    class="input-funcioario-descricao"
                    type="text"
                    placeholder="Descrição"
                  />
                  <select
                    class="funcionario-account-selector"
                    name="funcionario-account"
                    required
                  ></select>
                </div>

                <div class="funcionario-group">
                  <hr class="funcionarios-line" />
                  <img
                    class="trash-pagamento-icon"
                    src="/assets/icons/delete_24dp_5F6368_FILL0_wght400_GRAD0_opsz24.svg"
                  />

                  <select
                    class="funcionario-selector"
                    name="funcionario-id"
                    required
                  ></select>
                  <input
                    class="input-funcionario-data"
                    type="text"
                    placeholder="Data"
                    maxlength="10"
                  />
                  <input
                    class="input-funcionario-pagamento"
                    type="number"
                    placeholder="Pagamento"
                    step="0.01"
                    min="0"
                  />
                  <input
                    class="input-funcioario-descricao"
                    type="text"
                    placeholder="Descrição"
                  />
                  <select
                    class="funcionario-account-selector"
                    name="funcionario-account"
                    required
                  ></select>
                </div>

                <div class="funcionario-group">
                  <hr class="funcionarios-line" />
                  <img
                    class="trash-pagamento-icon"
                    src="/assets/icons/delete_24dp_5F6368_FILL0_wght400_GRAD0_opsz24.svg"
                  />

                  <select
                    class="funcionario-selector"
                    name="funcionario-id"
                    required
                  ></select>
                  <input
                    class="input-funcionario-data"
                    type="text"
                    placeholder="Data"
                    maxlength="10"
                  />
                  <input
                    class="input-funcionario-pagamento"
                    type="number"
                    placeholder="Pagamento"
                    step="0.01"
                    min="0"
                  />
                  <input
                    class="input-funcioario-descricao"
                    type="text"
                    placeholder="Descrição"
                  />
                  <select
                    class="funcionario-account-selector"
                    name="funcionario-account"
                    required
                  ></select>
                </div>

                <div class="funcionario-group">
                  <hr class="funcionarios-line" />
                  <img
                    class="trash-pagamento-icon"
                    src="/assets/icons/delete_24dp_5F6368_FILL0_wght400_GRAD0_opsz24.svg"
                  />

                  <select
                    class="funcionario-selector"
                    name="funcionario-id"
                    required
                  ></select>
                  <input
                    class="input-funcionario-data"
                    type="text"
                    placeholder="Data"
                    maxlength="10"
                  />
                  <input
                    class="input-funcionario-pagamento"
                    type="number"
                    placeholder="Pagamento"
                    step="0.01"
                    min="0"
                  />
                  <input
                    class="input-funcioario-descricao"
                    type="text"
                    placeholder="Descrição"
                  />
                  <select
                    class="funcionario-account-selector"
                    name="funcionario-account"
                    required
                  ></select>
                </div>
              </section>

              <section class="pagamento-bottom-container">
                <button
                  class="pagamento-bottom-adicionar pagamento-bottom-btns"
                  type="button"
                >
                  Adicionar
                </button>
                <button
                  class="pagamento-bottom-send pagamento-bottom-btns"
                  id="pagamentoSendBtn"
                >
                  Enviar
                </button>
              </section>
            </form>
          </section>
        </section>

        <section class="tabela-pagamentos-content">
          <input
            type="text"
            id="search-bar"
            placeholder="Pesquisar pagamentos..."
          />

          <section class="tabela-holder">
            <table id="pagamentos-table" class="pagamentos-table">
              <thead>
                <tr>
                  <th class="payment-cell">Pagamento ID</th>
                  <th>Nome</th>
                  <th>Data</th>
                  <th>Valor</th>
                  <th>Descrição</th>
                  <th>Conta</th>
                  <th>Usuário</th>
                  <th>Opções</th>
                </tr>
              </thead>

              <tbody id="tbody-pagamentos-table"></tbody>
            </table>
            <div id="no-results-message" class="no-results-message">
              Nenhum resultado encontrado.
            </div>
          </section>
        </section>

        <section class="addaccount-content">
          <form id="addaccount-form" class="addaccount-form">
            <div class="addaccount-holder">
              <div class="addacc-selector-holder">
                <h5>Selecione o funcionário</h5>

                <select
                  class="addaccount-funcionario"
                  name="addaccount-funcionario-selector"
                  required
                ></select>
              </div>

              <div class="addacc-input-holder">
                <h5>Digite a conta</h5>

                <input
                  type="text"
                  class="addaccount-funcionario-account"
                  name="addaccount-account"
                  required
                />
              </div>

              <div class="addaccount-bottom-container">
                <button class="btn-send-addacc">Enviar</button>
              </div>
            </div>
          </form>
        </section>

        <section class="tabela-vendas-content">
          <form id="filtros-form">
            <div class="vendas-top-content">
              <div class="vendas-data-input-holder">
                <label class="tabela-vendas-date-label" for="order-date"
                  >Data:</label
                >
                <input
                  class="vendas-order-date"
                  type="text"
                  id="order-date"
                  name="order-date"
                  placeholder="dd/mm/yyyy"
                  maxlength="10"
                />
              </div>
              <button class="btn-filter-vendas" type="submit">Filtrar</button>
            </div>
          </form>

          <section class="vendas-table-holder">
            <table id="tabela-vendas" class="tabela-vendas">
              <thead>
                <tr>
                  <th class="thead-vendas-table">
                    <div
                      class="header-content sorting-header"
                      data-column="id"
                      data-order="asc"
                    >
                      <img
                        class="sorting-controls button"
                        src="/assets/icons/keyboard_arrow_up_24dp_5F6368_FILL0_wght400_GRAD0_opsz24.svg"
                      />
                      <span>ID do Pedido</span>
                    </div>
                  </th>
                  <th class="thead-vendas-table">
                    <div
                      class="header-content sorting-header"
                      data-column="hora"
                      data-order="asc"
                    >
                      <img
                        class="sorting-controls button"
                        src="/assets/icons/keyboard_arrow_up_24dp_5F6368_FILL0_wght400_GRAD0_opsz24.svg"
                      />
                      <span>Hora</span>
                    </div>
                  </th>
                  <th class="thead-vendas-table">
                    <div
                      class="header-content sorting-header"
                      data-column="valor"
                      data-order="asc"
                    >
                      <img
                        class="sorting-controls button"
                        src="/assets/icons/keyboard_arrow_up_24dp_5F6368_FILL0_wght400_GRAD0_opsz24.svg"
                      />
                      <span>Valor</span>
                    </div>
                  </th>
                  <th>Quem registrou</th>
                </tr>
              </thead>
              <tbody id="vendas-table-body"></tbody>
            </table>
          </section>

          <div class="tabela-vendas-bottom-content">
            <button class="btn-vendas-itens">Vendas</button>
          </div>

          <section class="modal-vendas-itens-holder">
            <section class="modal-vendas-itens-content">
              <div class="modal-vendas-itens-top">
                <h5 class="modal-vendas-top-title">Produtos vendidos</h5>
                <img
                  class="btn-close-sales-itens"
                  src="/assets/icons/close_24dp_5F6368_FILL0_wght400_GRAD0_opsz24.svg"
                  alt="Fechar menu"
                />
              </div>
              <div class="modal-vendas-itens-mid">
                <div class="tabela-vendas-info"></div>
              </div>
            </section>
          </section>
        </section>

        <section class="detalhes-vendas-container">
          <section class="detalhes-vendas-content">
            <div class="detalhes-top-content">
              <img
                class="btn-close-sales-details"
                src="/assets/icons/close_24dp_5F6368_FILL0_wght400_GRAD0_opsz24.svg"
                alt="Fechar menu"
              />
            </div>

            <section class="tabela-sales-holder">
              <table class="tabela-sales-details">
                <thead>
                  <th>Nome do produto</th>
                  <th>Quantidade</th>
                  <th>Preço</th>
                </thead>

                <tbody class="tabela-sales-details-body"></tbody>
              </table>
            </section>
          </section>
        </section>

        <section class="cardapio-container">
          <section class="cardapio-content">
            <div class="cardapio-content-top">
              <button class="cardapio-close-btn">
                <img src="/assets/icons/arrow_back_ios_24dp_5F6368_FILL0_wght400_GRAD0_opsz24.svg" />
              </button>
              <hr />
            </div>
            <div class="cardapio-imgs-holder">
              <img src="/assets/images/cardapio_1.png" />
              <img src="/assets/images/cardapio_2.png" />
              <img src="/assets/images/cardapio_3.png" />
              <img src="/assets/images/cardapio_4.png" />
              <img src="/assets/images/cardapio_5.png" />
              <img src="/assets/images/cardapio_6.png" />
              <img src="/assets/images/cardapio_7.png" />
            </div>
          </section>
        </section>

        <button class="btn-open-menu-home">
          <img src="/assets/icons/cardapio.png" />
        </button>
      </section>
    </main>

    <footer class="footer outmodal-content">
      <section class="footer-content container-grid">
        <div class="help-msg-container">
          <h5 class="help-msg">Dúvidas ?</h5>
          <img
            class="help-icon"
            src="/assets/icons/help_24dp_5F6368_FILL0_wght400_GRAD0_opsz24.svg"
          />
        </div>
      </section>
    </footer>

    <script type="module">
      import { formatDateString } from "/scripts/formData.js";
      import { paymentsSearchBar } from "/scripts/menu.js";
      import { addDeleteEventListeners } from "/scripts/menu.js";

      document
        .querySelector(".btn-login")
        .addEventListener("click", function () {
          window.location.href = "/login";
        });

      document
        .querySelector(".btn-logout")
        .addEventListener("click", function () {
          fetch("/logout", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            credentials: "include",
          })
            .then((response) => {
              if (response.ok) {
                window.location.href = "/login";
              } else {
                alert("Erro ao fazer logout. Tente novamente.");
              }
            })
            .catch((error) => {
              console.error("Erro ao fazer logout:", error);
            });
        });

      document.addEventListener("DOMContentLoaded", function () {
        fetch("/get-username")
          .then((response) => response.json())
          .then((data) => {
            document.getElementById(
              "username-display"
            ).innerHTML = `<img src="/assets/icons/account_circle_24dp_5F6368_FILL0_wght400_GRAD0_opsz24.svg"> Seja bem vindo(a), <span>${data.username}</span>`;
            document.querySelector(".btn-login").style.display = "none";
            document.querySelector(".btn-logout").style.display = "block";
          })
          .catch((error) => {
            console.error("Erro ao buscar o username:", error);
          });

        document
          .querySelector(".btn-payments")
          .addEventListener("click", async () => {
            const tabelaPagamentos = document.getElementById(
              "tbody-pagamentos-table"
            );

            if (tabelaPagamentos.rows.length === 0) {
              fetch("/api/tabela")
                .then((response) => response.json())
                .then((data) => {
                  console.log(data);

                  data.forEach((item) => {
                    const row = document.createElement("tr");
                    const formattedDate = formatDateString(item.payment_date);

                    row.innerHTML = `
              <td>${item.pagamento_id}</td>
              <td>${item.funcionario_name}</td>
              <td>${formattedDate}</td>
              <td>${item.payment_amount}</td>
              <td>${item.description}</td>
              <td>${item.account}</td>
              <td>${item.username}</td>
              <td class="tabela-pagamentos-options"><img class="pagamentos-delete-btn" src="/assets/icons/delete_24dp_5F6368_FILL0_wght400_GRAD0_opsz24.svg" data-id="${item.pagamento_id}"></td>
            `;

                    tabelaPagamentos.appendChild(row);
                  });

                  addDeletePagamentoEventListeners();
                })
                .catch((error) =>
                  console.error("Erro ao buscar dados:", error)
                );
            }
          });

        function addDeletePagamentoEventListeners() {
          document
            .querySelectorAll(".pagamentos-delete-btn")
            .forEach((button) => {
              button.addEventListener("click", async (event) => {
                const id = event.target.getAttribute("data-id");

                console.log("Botão clicado");

                try {
                  const response = await fetch(`/delete-payment/${id}`, {
                    method: "DELETE",
                  });

                  const result = await response.json();
                  if (response.ok) {
                    alert(result.message);
                    event.target.closest("tr").remove();
                  } else {
                    alert(result.error);
                  }
                } catch (error) {
                  console.error("Erro ao deletar pagamento:", error);
                  alert("Erro ao deletar pagamento.");
                }
              });
            });

          console.log("Função executada!");
        }

        const funcionarioGroups =
          document.querySelectorAll(".funcionario-group");

        funcionarioGroups.forEach((group) => {
          const funcionarioSelector = group.querySelector(
            ".funcionario-selector"
          );
          const accountSelector = group.querySelector(
            ".funcionario-account-selector"
          );

          funcionarioSelector.addEventListener("change", () => {
            const funcionarioId = funcionarioSelector.value;
            updateAccountSelector(accountSelector, funcionarioId);
          });
        });

        function updateAccountSelector(accountSelector, funcionarioId) {
          accountSelector.innerHTML = "";

          fetch(`/api/accounts?funcionario_id=${funcionarioId}`)
            .then((response) => response.json())
            .then((data) => {
              data.forEach((account) => {
                const option = document.createElement("option");
                option.value = account.funcionario_account;
                option.textContent = account.funcionario_account;
                accountSelector.appendChild(option);
              });
            })
            .catch((error) => console.error("Erro ao buscar contas:", error));
        }

        paymentsSearchBar();
        addDeleteEventListeners();
      });
    </script>
  </body>
</html>
